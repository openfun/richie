<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2.29.2 docs-doc-page docs-doc-id-synchronizing-course-runs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Synchronizing course runs between Richie and OpenEdX | Richie</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://richie.education/img/undraw_online.svg"><meta data-rh="true" name="twitter:image" content="https://richie.education/img/undraw_online.svg"><meta data-rh="true" property="og:url" content="https://richie.education/docs/2.29.2/synchronizing-course-runs"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2.29.2"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.29.2"><meta data-rh="true" name="docsearch:version" content="2.29.2"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.29.2"><meta data-rh="true" property="og:title" content="Synchronizing course runs between Richie and OpenEdX | Richie"><meta data-rh="true" name="description" content="Richie can receive automatic course runs updates on a dedicated API endpoint."><meta data-rh="true" property="og:description" content="Richie can receive automatic course runs updates on a dedicated API endpoint."><link data-rh="true" rel="canonical" href="https://richie.education/docs/2.29.2/synchronizing-course-runs"><link data-rh="true" rel="alternate" href="https://richie.education/docs/2.29.2/synchronizing-course-runs" hreflang="en"><link data-rh="true" rel="alternate" href="https://richie.education/docs/2.29.2/synchronizing-course-runs" hreflang="x-default"><script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/assets/css/styles.031ea256.css">
<script src="/assets/js/runtime~main.249126e2.js" defer="defer"></script>
<script src="/assets/js/main.af1419be.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Richie</b></a><a class="navbar__item navbar__link" href="/docs/discover">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/2.29.2/synchronizing-course-runs">2.29.2</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/synchronizing-course-runs">Next</a></li><li><a class="dropdown__link" href="/docs/synchronizing-course-runs">3.1.1</a></li><li><a class="dropdown__link" href="/docs/3.1.0/synchronizing-course-runs">3.1.0</a></li><li><a class="dropdown__link" href="/docs/3.0.0/synchronizing-course-runs">3.0.0</a></li><li><a class="dropdown__link" href="/docs/2.34.0/synchronizing-course-runs">2.34.0</a></li><li><a class="dropdown__link" href="/docs/2.33.0/synchronizing-course-runs">2.33.0</a></li><li><a class="dropdown__link" href="/docs/2.32.0/synchronizing-course-runs">2.32.0</a></li><li><a class="dropdown__link" href="/docs/2.31.0/synchronizing-course-runs">2.31.0</a></li><li><a class="dropdown__link" href="/docs/2.30.0/synchronizing-course-runs">2.30.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.29.2/synchronizing-course-runs">2.29.2</a></li><li><a class="dropdown__link" href="/docs/2.29.1/synchronizing-course-runs">2.29.1</a></li><li><a class="dropdown__link" href="/docs/2.29.0/synchronizing-course-runs">2.29.0</a></li><li><a class="dropdown__link" href="/docs/2.28.1/synchronizing-course-runs">2.28.1</a></li><li><a class="dropdown__link" href="/docs/2.28.0/synchronizing-course-runs">2.28.0</a></li><li><a class="dropdown__link" href="/docs/2.27.0/synchronizing-course-runs">2.27.0</a></li><li><a class="dropdown__link" href="/docs/2.26.0/synchronizing-course-runs">2.26.0</a></li><li><a class="dropdown__link" href="/docs/2.25.1/synchronizing-course-runs">2.25.1</a></li><li><a class="dropdown__link" href="/docs/2.25.0/synchronizing-course-runs">2.25.0</a></li><li><a class="dropdown__link" href="/docs/2.25.0-beta.1/synchronizing-course-runs">2.25.0-beta.1</a></li><li><a class="dropdown__link" href="/docs/2.25.0-beta.0/synchronizing-course-runs">2.25.0-beta.0</a></li><li><a class="dropdown__link" href="/docs/2.24.1/synchronizing-course-runs">2.24.1</a></li><li><a class="dropdown__link" href="/docs/2.24.0/synchronizing-course-runs">2.24.0</a></li><li><a class="dropdown__link" href="/docs/2.23.0/synchronizing-course-runs">2.23.0</a></li><li><a class="dropdown__link" href="/docs/2.22.0/synchronizing-course-runs">2.22.0</a></li><li><a class="dropdown__link" href="/docs/2.21.1/synchronizing-course-runs">2.21.1</a></li><li><a class="dropdown__link" href="/docs/2.21.0/synchronizing-course-runs">2.21.0</a></li><li><a class="dropdown__link" href="/docs/2.20.1/synchronizing-course-runs">2.20.1</a></li><li><a class="dropdown__link" href="/docs/2.20.0/synchronizing-course-runs">2.20.0</a></li><li><a class="dropdown__link" href="/docs/2.19.0/synchronizing-course-runs">2.19.0</a></li><li><a class="dropdown__link" href="/docs/2.18.0/synchronizing-course-runs">2.18.0</a></li><li><a class="dropdown__link" href="/docs/2.17.0/synchronizing-course-runs">2.17.0</a></li><li><a class="dropdown__link" href="/docs/2.16.0/synchronizing-course-runs">2.16.0</a></li><li><a class="dropdown__link" href="/docs/2.15.1/synchronizing-course-runs">2.15.1</a></li><li><a class="dropdown__link" href="/docs/2.15.0/synchronizing-course-runs">2.15.0</a></li><li><a class="dropdown__link" href="/docs/2.14.1/synchronizing-course-runs">2.14.1</a></li><li><a class="dropdown__link" href="/docs/2.14.0/synchronizing-course-runs">2.14.0</a></li><li><a class="dropdown__link" href="/docs/2.13.0/synchronizing-course-runs">2.13.0</a></li><li><a class="dropdown__link" href="/docs/2.12.0/synchronizing-course-runs">2.12.0</a></li><li><a class="dropdown__link" href="/docs/2.11.0/synchronizing-course-runs">2.11.0</a></li><li><a class="dropdown__link" href="/docs/2.10.0/synchronizing-course-runs">2.10.0</a></li><li><a class="dropdown__link" href="/docs/2.9.1/synchronizing-course-runs">2.9.1</a></li><li><a class="dropdown__link" href="/docs/2.9.0/synchronizing-course-runs">2.9.0</a></li><li><a class="dropdown__link" href="/docs/2.8.2/synchronizing-course-runs">2.8.2</a></li><li><a class="dropdown__link" href="/docs/2.8.1/synchronizing-course-runs">2.8.1</a></li><li><a class="dropdown__link" href="/docs/2.8.0/synchronizing-course-runs">2.8.0</a></li><li><a class="dropdown__link" href="/docs/2.7.1/discover">2.7.1</a></li><li><a class="dropdown__link" href="/docs/2.7.0/discover">2.7.0</a></li><li><a class="dropdown__link" href="/docs/2.6.0/discover">2.6.0</a></li><li><a class="dropdown__link" href="/docs/2.5.0/discover">2.5.0</a></li><li><a class="dropdown__link" href="/docs/2.4.0/discover">2.4.0</a></li><li><a class="dropdown__link" href="/docs/2.3.3/discover">2.3.3</a></li><li><a class="dropdown__link" href="/docs/2.3.2/discover">2.3.2</a></li><li><a class="dropdown__link" href="/docs/2.3.1/discover">2.3.1</a></li><li><a class="dropdown__link" href="/docs/2.3.0/discover">2.3.0</a></li><li><a class="dropdown__link" href="/docs/2.2.0/discover">2.2.0</a></li><li><a class="dropdown__link" href="/docs/2.1.0/discover">2.1.0</a></li><li><a class="dropdown__link" href="/docs/2.0.1/discover">2.0.1</a></li><li><a class="dropdown__link" href="/docs/2.0.0/discover">2.0.0</a></li><li><a class="dropdown__link" href="/docs/1.17/discover">1.17</a></li><li><a class="dropdown__link" href="/docs/1.16/discover">1.16</a></li><li><a class="dropdown__link" href="/docs/1.15/discover">1.15</a></li><li><a class="dropdown__link" href="/docs/1.14/discover">1.14</a></li><li><a class="dropdown__link" href="/docs/1.13/discover">1.13</a></li><li><a class="dropdown__link" href="/docs/1.12/discover">1.12</a></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div><a class="navbar__item navbar__link" href="/help">Help</a><a href="https://github.com/openfun/richie" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Richie<!-- --> <b>2.29.2</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/synchronizing-course-runs">latest version</a></b> (<!-- -->3.1.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.29.2</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Synchronizing course runs between Richie and OpenEdX</h1></header><p>Richie can receive automatic course runs updates on a dedicated API endpoint.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-a-shared-secret">Configure a shared secret<a href="#configure-a-shared-secret" class="hash-link" aria-label="Direct link to Configure a shared secret" title="Direct link to Configure a shared secret">​</a></h2>
<p>In order to activate the course run synchronization API endpoint, you first need to configure the
<code>RICHIE_COURSE_RUN_SYNC_SECRETS</code> setting with one or more secrets:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">RICHIE_COURSE_RUN_SYNC_SECRETS </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SharedSecret&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;OtherSharedSecret&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This setting collects several secrets in order to allow rotating them without any downtime. Any
of the secrets listed in this setting can be used to sign your queries.</p>
<p>Your secret should be shared with the LMS or distant system that needs to synchronize its course
runs with the Richie instance. Richie will try the declared secrets one by one until it finds
one that matches the signature sent by the remote system.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-lms-backends">Configure LMS backends<a href="#configure-lms-backends" class="hash-link" aria-label="Direct link to Configure LMS backends" title="Direct link to Configure LMS backends">​</a></h2>
<p>You then need to configure the LMS handler via the <code>RICHIE_LMS_BACKENDS</code> setting as explained
in our <a href="/docs/2.29.2/lms-backends#configuring-the-lms-handler">guide on configuring LMS backends</a>. This is
required if you want Richie to create a new course run automatically and associate it with the
right course when the resource link submitted to the course run synchronization API endpoint is
unknown to Richie.</p>
<p>Each course run can be set to react differently to a synchronization request, thanks to the
<code>sync_mode</code> field. This field can be set to one of the following values:</p>
<ul>
<li><code>manual</code>: this course run is ignored by the course runs synchronization script. In this case,
the course run can only be edited manually using the DjangoCMS frontend editing.</li>
<li><code>sync_to_draft</code>: only the draft version of this course run is synchronized. A manual
publication is necessary for the update to be visible on the public site.</li>
<li><code>sync_to_public</code>: the public version of this course run is updated by the synchronization
script. As a results, updates are directly visible on the public site without further
publication by a staff user in Richie.</li>
</ul>
<p>A <a href="/docs/2.29.2/lms-backends#default_course_run_sync_mode">DEFAULT_COURSE_RUN_SYNC_MODE parameter</a> in the
<code>RICHIE_LMS_BACKENDS</code> setting, defines what default value is used for new course runs.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="make-a-synchronization-query">Make a synchronization query<a href="#make-a-synchronization-query" class="hash-link" aria-label="Direct link to Make a synchronization query" title="Direct link to Make a synchronization query">​</a></h2>
<p>You can refer to the <a href="/docs/2.29.2/api/course-run-synchronization-api">documentation of the course run synchronization API</a> for details
on the query expected by this endpoint.</p>
<p>We also share here our sample code to call this synchronization endpoint from OpenEdX. This code
should run on the <code>post_publish</code> signal emitted by the OpenEdX <code>cms</code> application each time a
course run is modified and published.</p>
<p>Or you can use the <a href="https://github.com/fccn/richie-openedx-sync" target="_blank" rel="noopener noreferrer">Richie Open edX Synchronization</a>
which is based on the following code sample and also includes the enrollment count.</p>
<p>Given a <code>COURSE_HOOK</code> setting defined as follows in your OpenEdX instance:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">COURSE_HOOK </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;secret&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SharedSecret&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;url&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://richie.example.com/api/v1.0/course-runs-sync/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The code for the synchronization function in OpenEdX could look like this:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> hashlib</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> hmac</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">conf </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> settings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> microsite_configuration </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> microsite</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xmodule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">modulestore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">django </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> modulestore</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">update_course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">course_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">&quot;&quot;&quot;Synchronize an OpenEdX course, identified by its course key, with a Richie instance.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    course </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> modulestore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">course_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    edxapp_domain </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> microsite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;site_domain&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">LMS_BASE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    data </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;resource_link&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://{:s}/courses/{!s}/info&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            edxapp_domain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> course_key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;start&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">start </span><span class="token keyword" style="font-style:italic">and</span><span class="token plain"> course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;end&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">end </span><span class="token keyword" style="font-style:italic">and</span><span class="token plain"> course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enrollment_start&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">enrollment_start </span><span class="token keyword" style="font-style:italic">and</span><span class="token plain"> course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">enrollment_start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;enrollment_end&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">enrollment_end </span><span class="token keyword" style="font-style:italic">and</span><span class="token plain"> course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">enrollment_end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;languages&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">language </span><span class="token keyword" style="font-style:italic">or</span><span class="token plain"> settings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">LANGUAGE_CODE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    signature </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> hmac</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        setting</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">COURSE_HOOK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;secret&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;utf-8&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;utf-8&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        digestmod</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">hashlib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sha256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hexdigest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    response </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">post</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        setting</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">COURSE_HOOK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;url&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        json</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        headers</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Authorization&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SIG-HMAC-SHA256 {:s}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">signature</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Thanks to the signal emitted in OpenEdX, this function can then be triggered each time a course
is modified and published:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dispatch </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> receiver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xmodule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">modulestore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">django </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> SignalHandler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@receiver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SignalHandler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">course_published</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> dispatch_uid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;update_course_on_publish&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">update_course_on_publish</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> course_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    update_course</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">course_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-09-23T09:25:02.000Z" itemprop="dateModified">Sep 23, 2024</time></b> by <b>jbpenrath</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configure-a-shared-secret" class="table-of-contents__link toc-highlight">Configure a shared secret</a></li><li><a href="#configure-lms-backends" class="table-of-contents__link toc-highlight">Configure LMS backends</a></li><li><a href="#make-a-synchronization-query" class="table-of-contents__link toc-highlight">Make a synchronization query</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/discover">Getting started</a></li><li class="footer__item"><a class="footer__link-item" href="/versions">Versions</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Contributing</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/users">User Showcase</a></li><li class="footer__item"><a href="https://github.com/openfun/richie" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Creative Commons 2022 — Richie contributors / Illustrations Katerina Limpitsouni</div></div></div></footer></div>
</body>
</html>