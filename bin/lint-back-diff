#!/usr/bin/env bash
source "$(dirname "${BASH_SOURCE[0]}")/_config.sh"

DIFF_FILES="$(git diff --name-only master | grep -e .py$ | grep -v migrations || true)"
DIFF_WITH_TESTS="$(echo "$DIFF_FILES" | tr "\n" " ")" || true
DIFF_NO_TESTS="$(echo "$DIFF_FILES" | grep -v tests/ | tr "\n" " ")" || true

if [ -z "$DIFF_FILES" ]; then
    echo "Nothing new to lint since master"
    exit 0
fi

_dc_run --no-deps app pylint $DIFF_WITH_TESTS
_dc_run --no-deps app black $DIFF_WITH_TESTS
_dc_run --no-deps app flake8 $DIFF_WITH_TESTS
_dc_run --no-deps app isort --recursive --atomic $DIFF_WITH_TESTS
_dc_run --no-deps app bandit -qr $DIFF_NO_TESTS
